/*
| A user on a skid for database storage.
|
| FIXME rename userInfoSkid
*/
'use strict';


tim.define( module, ( def, database_userSkid ) => {


/*::::::::::::::::::::::::::::.
:: Typed immutable attributes
':::::::::::::::::::::::::::::*/


if( TIM )
{
	def.attributes =
	{
		// the username
		_id : { type : 'string', json : true },

		// password hash
		passhash : { type : 'string', json : true },

		// the users email
		mail : { type : 'string', defaultValue : '""', json : true },

		// true if the user checked okay with news emails
		news : { type : [ 'boolean', 'string' ], json : true },

		// clear password for autogenerated users
		// FIXME I believe this can go!
		clearPass : { type : [ 'undefined', 'string' ], json : true },
	};

	def.json = 'database_userSkid';
}


/*:::::::::.
:: Imports
'::::::::::*/


const user_info = require( '../user/info' );


/*::::::::::::::::::.
:: Static functions
':::::::::::::::::::*/


/*
| Creates a database_userSkid from a user_info.
*/
def.static.createFromUser =
	function(
		user
	)
{
	const dus =
		database_userSkid.create(
			'_id', user.name,
			'passhash', user.passhash,
			'mail', user.mail,
			'news', user.news
		);

	tim.aheadValue( dus, 'asUser', user );

	return dus;
};


/*:::::::::::::.
:: Lazy values
'::::::::::::::*/


def.lazy.asUser =
	function( )
{
	return(
		user_info.create(
			'name', this._id,
			'passhash', this.passhash,
			'mail', this.mail,
			'news', this.news
		)
	);
};


} );
