/*
| A user on a skid for database storage.
|
| FIXME rename userInfoSkid
*/
'use strict';


tim.define( module, 'database_userSkid', ( def, database_userSkid ) => {


/*::::::::::::::::::::::::::::.
:: Typed immutable attributes
':::::::::::::::::::::::::::::*/


if( TIM )
{
	def.attributes =
	{
		_id :
		{
			// the username
			type : 'string',
			json : true,
		},
		passhash :
		{
			// password hash
			type : 'string',
			json : true,
		},
		mail :
		{
			// the users email
			type : 'string',
			defaultValue : '""',
			json : true,
		},
		news :
		{
			// true if the user checked okay with news emails
			type : [ 'boolean', 'string' ],
			json : true,
		},
		clearPass :
		{
			// clear password for autogenerated users
			// FIXME I believe this can go!
			json : true,
			type : [ 'undefined', 'string' ]
		}
	};
}


/*:::::::::.
:: Imports
'::::::::::*/


const user_info = require( '../user/info' );


/*::::::::::::::::::.
:: Static functions
':::::::::::::::::::*/


/*
| Creates a database_userSkid from a user_info.
*/
def.static.createFromUser =
	function(
		user
	)
{
	const dus =
		database_userSkid.create(
			'_id', user.name,
			'passhash', user.passhash,
			'mail', user.mail,
			'news', user.news
		);

	tim.aheadValue( dus, 'asUser', user );

	return dus;
};


/*:::::::::::::.
:: Lazy values
'::::::::::::::*/


def.lazy.asUser =
	function( )
{
	return(
		user_info.create(
			'name', this._id,
			'passhash', this.passhash,
			'mail', this.mail,
			'news', this.news
		)
	);
};


} );
